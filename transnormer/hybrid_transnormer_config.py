from dataclasses import dataclass, field
from typing import List, Dict

@dataclass
class TransnormerConfig:
    hidden_size: int = 768
    rms_norm_eps: float = 1e-5
    vocab_size: int = None
    intermediate_size: int = 912
    hidden_act: str = "silu"
    num_hidden_layers: int = 28
    attn_layers: List[int] = field(default_factory=list)
    num_attention_heads: int = 12
    num_key_value_heads: int = 2
    head_perm_dict: dict = field(default_factory=lambda: {
        "0": [
            1,
            2,
            3,
            5,
            6,
            8,
            9,
            10,
            11,
            0,
            4,
            7
        ],
        "1": [
            0,
            1,
            3,
            4,
            9,
            11,
            2,
            5,
            6,
            7,
            8,
            10
        ],
        "2": [
            0,
            1,
            7,
            8,
            10,
            11,
            2,
            3,
            4,
            5,
            6,
            9
        ],
        "3": [
            0,
            1,
            2,
            3,
            5,
            10,
            4,
            6,
            7,
            8,
            9,
            11
        ],
        "4": [
            2,
            5,
            6,
            7,
            9,
            11,
            0,
            1,
            3,
            4,
            8,
            10
        ],
        "5": [
            1,
            6,
            8,
            9,
            0,
            2,
            3,
            4,
            5,
            7,
            10,
            11
        ],
        "6": [
            4,
            5,
            8,
            9,
            10,
            11,
            0,
            1,
            2,
            3,
            6,
            7
        ],
        "7": [
            1,
            3,
            5,
            7,
            8,
            9,
            10,
            0,
            2,
            4,
            6,
            11
        ],
        "8": [
            5,
            6,
            8,
            9,
            10,
            11,
            0,
            1,
            2,
            3,
            4,
            7
        ],
        "9": [
            0,
            1,
            2,
            4,
            5,
            10,
            11,
            3,
            6,
            7,
            8,
            9
        ],
        "10": [
            1,
            5,
            8,
            0,
            2,
            3,
            4,
            6,
            7,
            9,
            10,
            11
        ],
        "11": [
            1,
            2,
            4,
            8,
            11,
            0,
            3,
            5,
            6,
            7,
            9,
            10
        ],
        "12": [
            7,
            8,
            9,
            10,
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            11
        ],
        "13": [
            0,
            2,
            3,
            4,
            6,
            7,
            8,
            9,
            10,
            11,
            1,
            5
        ],
        "14": [
            5,
            7,
            8,
            9,
            0,
            1,
            2,
            3,
            4,
            6,
            10,
            11
        ],
        "15": [
            0,
            5,
            7,
            9,
            11,
            1,
            2,
            3,
            4,
            6,
            8,
            10
        ],
        "16": [
            8,
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            9,
            10,
            11
        ],
        "17": [
            0,
            3,
            4,
            5,
            8,
            1,
            2,
            6,
            7,
            9,
            10,
            11
        ],
        "18": [
            0,
            2,
            4,
            5,
            7,
            8,
            10,
            11,
            1,
            3,
            6,
            9
        ],
        "19": [
            6,
            7,
            8,
            10,
            11,
            0,
            1,
            2,
            3,
            4,
            5,
            9
        ],
        "20": [
            0,
            8,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            9,
            10,
            11
        ],
        "21": [
            3,
            0,
            1,
            2,
            4,
            5,
            6,
            7,
            8,
            9,
            10,
            11
        ],
        "22": [
            0,
            1,
            2,
            3,
            5,
            4,
            6,
            7,
            8,
            9,
            10,
            11
        ],
        "23": [
            6,
            9,
            10,
            11,
            0,
            1,
            2,
            3,
            4,
            5,
            7,
            8
        ],
        "24": [
            0,
            1,
            2,
            3,
            4,
            7,
            5,
            6,
            8,
            9,
            10,
            11
        ],
        "25": [
            3,
            0,
            1,
            2,
            4,
            5,
            6,
            7,
            8,
            9,
            10,
            11
        ],
        "26": [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9,
            10,
            11
        ],
        "27": [
            9,
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            10,
            11
        ]
    })
    head_split_dict: dict = field(default_factory=lambda: {
        "0": 9,
        "1": 6,
        "2": 6,
        "3": 6,
        "4": 6,
        "5": 4,
        "6": 6,
        "7": 7,
        "8": 6,
        "9": 7,
        "10": 3,
        "11": 5,
        "12": 4,
        "13": 10,
        "14": 4,
        "15": 5,
        "16": 1,
        "17": 5,
        "18": 8,
        "19": 5,
        "20": 2,
        "21": 1,
        "22": 5,
        "23": 4,
        "24": 6,
        "25": 1,
        "26": 1,
        "27": 1
    })
    # head_mask_perm_list: List[List[int]] = None
    head_mask_perm_list: List[List[int]] = field(default_factory=lambda: 
        [None, [3, 4, 2, 3, 4, 3, 6, 7, 8, 6, 7, 7], [0, 2, 2, 4, 4, 0, 6, 6, 8, 6, 6, 11], [5, 1, 2, 3, 4, 5, 9, 7, 8, 9, 9, 11], [3, 1, 3, 3, 1, 3, 6, 7, 8, 6, 10, 11], [0, 1, 2, 3, 4, 5, 10, 7, 10, 7, 10, 11], [2, 3, 2, 3, 3, 2, 6, 6, 11, 2, 10, 11], [5, 1, 2, 3, 4, 5, 6, 7, 8, 7, 8, 11], [0, 1, 2, 4, 4, 5, 6, 7, 8, 9, 10, 11], [0, 1, 2, 3, 2, 5, 6, 6, 6, 6, 6, 6], [4, 1, 2, 4, 4, 5, 6, 8, 8, 11, 10, 11], [3, 5, 5, 3, 5, 5, 6, 7, 8, 9, 10, 11], [0, 3, 0, 3, 4, 0, 6, 7, 10, 9, 10, 11], [3, 3, 4, 3, 4, 3, 11, 11, 11, 11, 11, 11], [2, 2, 2, 3, 4, 5, 10, 10, 10, 10, 10, 10], [0, 1, 2, 2, 4, 5, 11, 9, 8, 9, 10, 11], [0, 1, 1, 1, 1, 5, 8, 10, 8, 8, 10, 10], [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4], [5, 3, 2, 3, 4, 5, 7, 7, 8, 7, 10, 11], [3, 3, 3, 3, 3, 3, 10, 10, 10, 10, 10, 10], [0, 3, 2, 3, 4, 5, 6, 7, 8, 9, 9, 11], [5, 5, 5, 5, 5, 5, 11, 11, 11, 11, 11, 11], [0, 0, 0, 0, 0, 0, 10, 10, 10, 10, 10, 10], [3, 3, 3, 3, 3, 5, 11, 7, 8, 11, 11, 11], [3, 1, 1, 3, 1, 5, 3, 5, 1, 3, 1, 1], [5, 5, 5, 5, 5, 5, 7, 7, 7, 7, 7, 7], [0, 3, 5, 3, 5, 5, 6, 9, 9, 9, 9, 11], [3, 3, 3, 3, 3, 3, 6, 6, 6, 6, 10, 6]]
    )
    layer_mask_lst: List[bool] = None #field(default_factory=lambda: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1])
    head_policy_dict: dict = None # field(default_factory=lambda: {
    #     "0": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "1": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "2": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "3": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "4": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "5": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "6": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "7": [6, 7, 8, 9, 10, 11], "8": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "9": [0, 1, 2, 3, 4, 5], "10": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "11": [0, 1, 2, 3, 4, 5], "12": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "13": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "14": [0, 1, 2, 3, 4, 5], "16": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "17": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "18": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "19": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "20": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "21": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "22": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "23": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "24": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "25": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "26": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11], "27": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
    # })
    num_experts: int = 128
    num_experts_per_tok: int = 8
    norm_topk_prob: bool = True
    moe_intermediate_size: int = 768
    




